系统调优的最终目标：

- 使应用运行得更快；
- 缩短查询/事务的响应时间；
- 提高事务的整体吞吐量。

# 查询优化

在众多的查询方案中选择出最好效率的执行计划的一种处理过程。查询优化的方法：

- 代数优化：通过对关系代数表达式的等价变换来提高查询效率，代数优化改变查询语句中操作的次序和组合，不涉及底层的存取路径。
- 物理优化：通过选择高校合理的操作算法或存取路径，求得优化的查询计划。
  - 如选择操作典型实现方法有简单的**全表扫描方法**和**索引扫描方法**；
  - 常用的连接操作方法有**嵌套循环方法**、**排序-合并方法**、**索引连接方法**和**Hash Join方法**。

## 嵌套循环连接

选择一个表作为外表，另一个表作为内表。对外表（外层循环）的每一个元组，检索内表（内层循环）中的每一个元组。如果满足连接条件，则串接猴作为结果输出，直到外层循环表中的元组处理完为止。

### 索引嵌套循环连接

如果有一个关系建立了索引，则将建立了索引的关系作为内关系。

## 排序归并连接

如果连接的表没有排好序，先对两张表按连接属性排序。之后的操作与嵌套循环连接类似。

## 索引连接方法

取第一张表中第一个连接属性，根据索引找到第二张表中具有相同连接属性的元组。串接后作为结果输出，直到第一张表中的元组处理完为止。

## 哈希连接

把连接属性作为hash码，用同一个hash函数把两个表中的元组散列到hash表的桶中再进行匹配连接。

## 查询优化方法选择的依据

- 基于规则
- 基于代价：优化器利用关系的统计信息，如数据集的大小、是否存在索引等，对计划做出一个较为准确的估计。

### 执行开销

- 集中式数据库：磁盘存取块数（IO代价）、处理机时间（CPU代价）、查询的内存开销，其中IO代价使最重要的；
- 分布式数据库：IO代价、CPU代价、查询的内存开销、通信代价

### 调优需要的统计信息

存储统计、IO和设备性能统计、查询/事务处理统计、加锁/日志统计、索引统计

# 调优

## 索引的调优

- 判断并建立必要的索引：统计出常用且对性能有影响的语句。重点关注数据库中操作频繁的表，数据流量较大的表、经常需要与其他表进行连接的表等。
- 索引过多会影响到数据库的整体性能，需要一些规则进行约束：
  - 如果一个或一组属性经常在查询条件中出现，则考虑在这个或这组属性上建立索引（或组合索引）。
  - 如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引。
  - 如果一个或一组属性经常在连接操作的连接条件中出现，则考虑在这个或这组属性上建立索引。